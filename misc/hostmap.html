{% extends "layout_dc.html" %}
{% block content %}
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
           <h4>IAD Cloud VM load per physical host</h4>
           <div id="chartContainer">
           </div>
        </div>

<script>
var CHART = {
    onReady: function() {
        CHART.remoteUrl="/data/rackspace/hostmap";
        CHART.svg = dimple.newSvg("#chartContainer",590,400);
        CHART.loadChart("?dc=iad");
    },

    drawGraphs: function (dubdata) {
        dchart = new dimple.chart(CHART.svg, dubdata);
        dchart.setBounds(60, 30, 510, 305);
        xAxis = dchart.addCategoryAxis("x", "Host");
        dchart.addMeasureAxis("y", "Load");
        dchart.addMeasureAxis("z", "VMs");
        dchart.addSeries("VMs", dimple.plot.bar);
        dchart.draw();
        xAxis.shapes.selectAll("text").remove();
    },

    loadChart: function (qstring){
        querypath = CHART.remoteUrl;
        if (qstring) {
            querypath += qstring;
        }
        $.ajax({
            url: querypath,
            dataType: 'json',
            cache: true,
            timeout: 30000,
            success: function(data) {
                // $('#output ul').append('<li>The feed loads fine');
                CHART.drawGraphs(data);
                //setTimeout(loadChart, 60000);
            },
            error: function(){
                setTimeout(CHART.loadChart, 5000);
            }
        });
    }
};

$( document ).ready ( CHART.onReady );
</script>


{% endblock %}
